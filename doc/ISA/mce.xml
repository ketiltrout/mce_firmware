<MCE>
   <!-- 
   MCE.xml - example description of SCUBA-2 Multichannel Electronics
   The system consists of:
   - One Power Card
   - One Clock Card
   - One Address Card
   - Four Readout Cards
   - Three Bias Cards
   The declarations state the identifying address used to access each
   card and details of all the read/write/go parameters for each card. 
   -->

   <!-- 
   Instructions in "any" can be used to target any/all cards in the
   MCE.  The "0" value in the CardId field will be replaced with a valid
   card or card-group code. 
   -->


   <!-- 
   Parameters relevant to any FPGA-controlled card.
   The parameter can target any FPGA-controlled card(s) - i.e. not the Power Supply Card 
   -->
   <any CardId="0">   
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!--<rst_wtchdog   ParId="0x40" Type="int" Count="1" />-->
      <!-- 48 words: <eeprom word #0><eeprom word #1>...<eeprom word #47> -->
      <eeprom        ParId="0x41" Type="int" Count="48" />
      <vfy_eeprom    ParId="0x42" Type="int" Count="1" />  
      <clr_error     ParId="0x43" Type="int" Count="1" />
      <!-- 1 word: <eeprom memory address> -->
      <eeprom_srt    ParId="0x44" Type="int" Count="1" Min="0" Max="1000000" />
      <bit_status    ParId="0x90" Type="int" Count="1" />
      <fpga_temp     ParId="0x91" Type="int" Count="1" />
      <card_temp     ParId="0x92" Type="int" Count="1" />
      <!-- 2 words: <card id word 0><card id word 1> -->
      <card_id       ParId="0x93" Type="int" Count="2" />   
      <card_type     ParId="0x94" Type="int" Count="1" /> 
      <slot_id       ParId="0x95" Type="int" Count="1" />
      <fmwr_vrsn     ParId="0x96" Type="int" Count="1" />
      <dip           ParId="0x97" Type="int" Count="1" />
      <cyc_oo_syc    ParId="0x98" Type="int" Count="1" />
      <led           ParId="0x99" Type="int" Count="1" />
   </any>

   <!-- 
   Parameters relevant to all FPGA-controlled cards at the same time. 
   The parameter must target all FPGA-controlled cards. 
   -->
   <sys CardId="0x0E" >   
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- Frame Timing Parameters -->
      <!-- #50MHz clock cycles per row -->                                                                 
      <row_len       ParId="0x30" Type="int" Count="1" />
      <!-- #rows on the MUX -->
      <num_rows      ParId="0x31" Type="int" Count="1" /> 
      <!-- 1 word: <# of 50Mhz cycles to delay sampling by from the star of the frame> -->
      <sample_dly    ParId="0x32" Type="int" Count="1"  Default="16" /> 
      <!-- 1 word: <# of 50Mhz sample to take after the delay-->
      <sample_num    ParId="0x33" Type="int" Count="1"  Default="40" />
      <!-- 1 word: <delay between row switch and application of new 1st stage FB> -->
      <fb_dly        ParId="0x34" Type="int" Count="1"  Default="3" />                          
      <!-- 1 word: <# of 50MHz cycles between switching off the current row, and on the next row> -->                                                                           
      <!-- This must be at least '1' to give the fsm time to load and latch the new on value after an off value -->                                                                           
      <!-- Currently the row dwell time goes until the last cycle -->                                                                           
      <row_dly       ParId="0x35" Type="int" Count="1"  Default="1" />           
      <resync        ParId="0x36" Type="int" Count="1" />
      <!-- 1 word: <a value of 1 causes the flux-feedback calculations to initialize> -->
      <flx_lp_init   ParId="0x37" Type="int" Count="1"  Default="0" /> 
   </sys>
   
   <rcs CardId="0x08">
      <!-- ******************************************* -->
      <!--  Start/Stop                                 -->
      <!-- ******************************************* -->
      
      <ret_dat       ParId="0x16" Type="cmd" Count="328" />

      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- 1 word: <data mode> -->
      <data_mode     ParId="0x17" Type="int" Count="1"  Default="0" />
      <!-- 1 word: <a value of 1 causes two frames of raw data to be recorded> -->
      <captr_raw     ParId="0x18" Type="int" Count="1"  Default="0" /> 
      <!-- 7 words: <filter coefficient 0>...<filter coefficient 6> -->
      <filt_coef     ParId="0x1A" Type="int" Count="7"  Default="0 0 0 0 0 0 0" />              
      <!-- 1 word:  <servo constant/ramp/dynamic> -->
      <servo_mode    ParId="0x1B" Type="int" Count="1"  Default="0" />         
      <!-- 1 word: <number of frame periods between consecutive steps in the ramp> -->
      <ramp_dly      ParId="0x1C" Type="int" Count="1"  Default="5" />  
      <!-- 1 word: <ramp amplitude, from 0..(2^14)-1> -->
      <ramp_amp      ParId="0x1D" Type="int" Count="1"  Default="8192" /> 
      <!-- 1 word: <ramp step-size, from 1..(2^14)-1> -->
      <ramp_step     ParId="0x1E" Type="int" Count="1"  Default="1" /> 
      <!-- 1 word: <const 1st stage FB value> -->
      <fb_const      ParId="0x1F" Type="int" Count="1"  Default="8192" /> 
   </rcs>

   <!-- 
   Parameters relevant to the Power Supply Card only 
   -->
   <psc CardId="0x01" >   
      <!-- ******************************************* -->
      <!-- Reset                                       -->
      <!-- ******************************************* -->
      
      <brst          ParId="0x60" Type="rst" Count="1" />
      <pow_cycle     ParId="0x61" Type="rst" Count="1" />

      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- 2 words, divided into several different fields -->
      <psc_status    ParId="0x62" Type="int" Count="2" /> 
      <!-- 1 word, each of 7 bits control a different power supply <+15VA><-15VA><+7VA><-7VA><+5VD><+4.5VD><+2.5VD> -->
      <pow_ctrl      ParID="0x63" Type="int" Count="1" />   
   </psc>

   <cc CardId="0x02" >   

      <!-- ******************************************* -->
      <!-- Reset                                       -->
      <!-- ******************************************* -->
      
      <config        ParId="0x50" Type="rst" Count="1" />
      <app_config    ParId="0x51" Type="rst" Count="1" />
      <fac_config    ParId="0x52" Type="rst" Count="1" /> 

      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- 2 words: <dataframe stating sequence number><dataframe ending sequence number> -->
      <ret_dat_s     ParId="0x53" Type="int" Count="2" CountDscr="StartSeqNum EndSeqNum"/>
      <!-- 1 word: <enable/disable the use of the DV pulse to generate internal sync pulses> -->
      <use_dv        ParId="0x54" Type="int" Count="1" />              
      <vrfy_sram1    ParId="0x55" Type="int" Count="0" />   
      <vrfy_sram2    ParId="0x56" Type="int" Count="0" />      
      <!-- 1 word: <device to be configured> -->
      <config_s      ParId="0x57" Type="int" Count="1" />
      <!-- 1 word: <array id> -->
      <array_id      ParId="0x58" Type="int" Count="1" /> 
      <!-- 2 words: <box is word 0><box id word 1> -->
      <box_id        ParId="0x59" Type="int" Count="2" />
      <!-- 48 words: <sram1 word #0><sram1 word #1>...<sram1 word #47> -->
      <sram1         ParId="0x5A" Type="int" Count="48" />  
      <!-- 48 words: <sram2 word #0><sram2 word #1>...<sram2 word #47> -->
      <sram2         ParId="0x5B" Type="int" Count="48" />  
      <!-- 48 words: <sram1 word #0><sram1 word #1>...<sram1 word #47> -->
      <sram1_cont    ParId="0x5C" Type="int" Count="48" />
      <!-- 48 words: <sram2 word #0><sram2 word #1>...<sram2 word #47> -->
      <sram2_cont    ParId="0x5D" Type="int" Count="48" />         
      <!-- 1 word: <sram1 memory address> -->
      <sram1_strt    ParId="0x5E" Type="int" Count="1" Default="0x00000000" />
      <!-- 1 word: <sram2 memory address> -->
      <sram2_strt    ParId="0x5F" Type="int" Count="1" Default="0x00000000" />   
   </cc>

   <ac CardId="0x0A" >   
                                                                      
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- 41 words: <row addressed at interval 0>...<row addressed at interval 40> -->
      <row_order     ParId="0x01" Type="int" Count="41" Default="0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40" />
      <!-- 41 words: <on-bais row 0>...<on-bias row 39><on-bias dark row> -->
      <on_bias       ParId="0x02" Type="int" Count="41" Min="0" Max="16383" />   
      <!-- 41 words: <off-bias row 0>...<off-bias row 39><off-bias dark row> -->
      <off_bias      ParId="0x03" Type="int" Count="41" Min="0" Max="16383" />   
      <!-- 41 words: <row on channel 0>..<row on channel 39><row on dark channel> -->
      <row_map       ParId="0x04" Type="int" Count="41" Default="0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40" />
      <!-- 1 word: <enable/disable multiplexing> -->
      <enbl_mux      ParId="0x05" Type="int" Count="1" />                        
   </ac>

   <!-- 
   There are four Readout Cards, each handling eight columns of pixels.
   Each card has an array parameter for which columns it handles. 
   -->
   <rc1 CardId="0x03" >   
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- 8 words: <series array bias 0>...<series array bias 7> -->
      <sa_bias       ParId="0x10" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />
      <!-- 8 words: <offset 0>...<offset 7> -->
      <offset        ParId="0x11" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />  
      <!-- 8 words: <column on channel 0>...<column on channel 7> -->
      <col_map       ParId="0x12" Type="int" Count="8"  Default="24 25 26 27 28 29 30 31" />   
      <!-- 41 words per ParId: <gainp row 0>...<gainp row 39><gainp dark row> -->
      <gainp         ParIds="0x70 0x71 0x72 0x73 0x74 0x75 0x76 0x77" Type="int" Count="41" />  
      <!-- 41 words per ParId: <gaini row 0>...<gaini row 39><gaini dark row> -->
      <gaini         ParIds="0x78 0x79 0x7A 0x7B 0x7C 0x7D 0x7E 0x7F" Type="int" Count="41" />  
      <!-- 41 words per ParId: <zero row 0>...<zero row 39><zero dark row> -->
      <zero          ParIds="0x80 0x81 0x82 0x83 0x84 0x85 0x86 0x87" Type="int" Count="41" />  
      <!-- 41 words per ParId: <gaind row 0>...<gaind row 39><gaind dark row> -->
      <gaind         ParIds="0x88 0x89 0x8A 0x8B 0x8C 0x8D 0x8E 0x8F" Type="int" Count="41" />  
      <!-- 41 words per ParId: <gaind row 0>...<gaind row 39><gaind dark row> -->
      <adc_offset    ParIds="0x68 0x69 0x6A 0x6B 0x6C 0x6D 0x6E 0x6F" Type="int" Count="41" />  
   </rc1>

   <rc2 CardId="0x04" >
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <sa_bias       ParId="0x10" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />
      <offset        ParId="0x11" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />  
      <col_map       ParId="0x12" Type="int" Count="8"  Default="24 25 26 27 28 29 30 31" />   
      <gainp         ParIds="0x70 0x71 0x72 0x73 0x74 0x75 0x76 0x77" Type="int" Count="41" />
      <gaini         ParIds="0x78 0x79 0x7A 0x7B 0x7C 0x7D 0x7E 0x7F" Type="int" Count="41" />
      <zero          ParIds="0x80 0x81 0x82 0x83 0x84 0x85 0x86 0x87" Type="int" Count="41" />
      <gaind         ParIds="0x88 0x89 0x8A 0x8B 0x8C 0x8D 0x8E 0x8F" Type="int" Count="41" />
      <adc_offset    ParIds="0x68 0x69 0x6A 0x6B 0x6C 0x6D 0x6E 0x6F" Type="int" Count="41" />
   </rc2>

   <rc3 CardId="0x05" >
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <sa_bias       ParId="0x10" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />
      <offset        ParId="0x11" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />  
      <col_map       ParId="0x12" Type="int" Count="8"  Default="24 25 26 27 28 29 30 31" />   
      <gainp         ParIds="0x70 0x71 0x72 0x73 0x74 0x75 0x76 0x77" Type="int" Count="41" />
      <gaini         ParIds="0x78 0x79 0x7A 0x7B 0x7C 0x7D 0x7E 0x7F" Type="int" Count="41" />
      <zero          ParIds="0x80 0x81 0x82 0x83 0x84 0x85 0x86 0x87" Type="int" Count="41" />
      <gaind         ParIds="0x88 0x89 0x8A 0x8B 0x8C 0x8D 0x8E 0x8F" Type="int" Count="41" />
      <adc_offset    ParIds="0x68 0x69 0x6A 0x6B 0x6C 0x6D 0x6E 0x6F" Type="int" Count="41" />
   </rc3>

   <rc4 CardId="0x06" >
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <sa_bias       ParId="0x10" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />
      <offset        ParId="0x11" Type="int" Count="8"  Default="0 0 0 0 0 0 0 0" />  
      <col_map       ParId="0x12" Type="int" Count="8"  Default="24 25 26 27 28 29 30 31" />   
      <gainp         ParIds="0x70 0x71 0x72 0x73 0x74 0x75 0x76 0x77" Type="int" Count="41" />
      <gaini         ParIds="0x78 0x79 0x7A 0x7B 0x7C 0x7D 0x7E 0x7F" Type="int" Count="41" />
      <zero          ParIds="0x80 0x81 0x82 0x83 0x84 0x85 0x86 0x87" Type="int" Count="41" />
      <gaind         ParIds="0x88 0x89 0x8A 0x8B 0x8C 0x8D 0x8E 0x8F" Type="int" Count="41" />
      <adc_offset    ParIds="0x68 0x69 0x6A 0x6B 0x6C 0x6D 0x6E 0x6F" Type="int" Count="41" />
   </rc4>

   <!-- 
   There are three physically identical Bias Cards but with different uses:
   - bc2 controls the flux feedback for all second stage SQUIDS and also the detector bias setting
   - bc3 controls the bias for the second stage SQUIDS and also the pixel heater power
   - bc1 controls the flux feedback for the SQUID series arrays
   -->
   <bc2 CardId="0x07" >
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <!-- 32 words: <flux feedback 0><flux feedback 1>...<flux feedback 31> -->
      <flux_fb       ParId="0x20" Type="int" Count="32" Default="0" />  
      <!-- 1 word: <bias> -->
      <bias          ParId="0x21" Type="int" Count="1"  Default="0" />  
   </bc2>

   <bc3 CardId="0x08" >
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <flux_fb       ParId="0x20" Type="int" Count="32" Default="0" />
      <bias          ParId="0x21" Type="int" Count="1"  Default="0" />
   </bc3>

   <bc1 CardId="0x09" >
      <!-- ******************************************* -->
      <!-- Read-Block/Write-Block                      -->
      <!-- ******************************************* -->
      
      <flux_fb       ParId="0x20" Type="int" Count="32" Default="0" />
      <bias          ParId="0x21" Type="int" Count="1"  Default="0" />
   </bc1>

</MCE>


